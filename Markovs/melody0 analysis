define variable melody = {60 57 63 59 63 55 61 53 56 62 55 58 64 57 63 59 66 43 67 61 53 56 62 55 58 67 59 62 57 54 68 61 53 56 42 71 73 51 54 60 65 48 63 56 62 65 60 61 57 60 63 59 63 72 73 47 70 58 57 64 60 48 63 52 74 58 61 43 55 60 42 57 41 78 50 64 80 46 60 63 49 82 62 73 83 54 69 38 64 66 68 70 42 59 61 63 65 69 71 38 75 77 68 70 41 59 61 63 65 76 78 37 60 71 36 57 68 37 60 71 64 36 57 68 70 38 47 55 66 36 57 68 37 60 71 64 43 57 68 36 45 53 64 33 42 50 61 36 45 53 64 67 69 33 42 50 61 36 59 70 35 56 36 45 53 64 33 42 50 61 31 40 48 59}

define variable rhythm = {0.0 0.8 60.0 0.8 0.0 0.8 0.6 57.0 0.8 0.0 1.4 0.5 63.0 0.8 0.0 1.9 0.4 59.0 0.8 0.0 2.3 0.4 63.0 0.8 0.0 2.8 0.6 55.0 0.8 0.0 3.4 0.6 61.0 0.8 0.0 3.8 0.4 53.0 0.8 0.0 4.0 0.4 56.0 0.8 0.0 4.4 0.4 62.0 0.8 0.0 4.8 0.6 55.0 0.8 0.0 5.4 0.6 58.0 0.8 0.0 6.0 0.8 64.0 0.8 0.0 6.8 0.6 57.0 0.8 0.0 7.4 0.5 63.0 0.8 0.0 7.9 0.4 59.0 0.8 0.0 8.3 0.8 66.0 0.8 0.0 8.5 1.0 43.0 0.8 0.0 9.1 0.4 67.0 0.8 0.0 9.4 0.6 61.0 0.8 0.0 9.8 0.4 53.0 0.8 0.0 10.0 0.4 56.0 0.8 0.0 10.4 1.6 62.0 0.8 0.0 10.8 0.6 55.0 0.8 0.0 11.4 0.6 58.0 0.8 0.0 12.0 0.8 67.0 0.8 0.0 12.8 0.9 59.0 0.8 0.0 13.5 0.8 62.0 0.8 0.0 14.3 0.8 57.0 0.8 0.0 14.5 1.1 54.0 0.8 0.0 15.1 0.3 68.0 0.8 0.0 15.4 0.6 61.0 0.8 0.0 15.8 0.4 53.0 0.8 0.0 16.0 0.5 56.0 0.8 0.0 16.8 2.0 42.0 0.8 0.0 17.6 1.1 71.0 0.8 0.0 18.8 1.3 73.0 0.8 0.0 19.3 0.6 51.0 0.8 0.0 19.9 0.6 54.0 0.8 0.0 20.4 0.8 60.0 0.8 0.0 21.1 1.0 65.0 0.8 0.0 21.4 1.1 48.0 0.8 0.0 21.9 1.0 63.0 0.8 0.0 22.9 1.8 56.0 0.8 0.0 22.9 0.6 62.0 0.8 0.0 23.5 1.1 65.0 0.8 0.0 24.3 0.4 60.0 0.8 0.0 24.6 0.6 61.0 0.8 0.0 25.3 2.1 57.0 0.8 0.0 26.0 1.4 60.0 0.8 0.0 27.4 0.5 63.0 0.8 0.0 27.9 0.4 59.0 0.8 0.0 28.3 0.4 63.0 0.8 0.0 28.6 1.1 72.0 0.8 0.0 29.8 0.8 73.0 0.8 0.0 30.4 1.3 47.0 0.8 0.0 30.9 1.1 70.0 0.8 0.0 31.3 1.8 58.0 0.8 0.0 31.8 1.3 57.0 0.8 0.0 33.0 0.8 64.0 0.8 0.0 33.8 0.8 60.0 0.8 0.0 34.5 0.9 48.0 0.8 0.0 34.5 1.1 63.0 0.8 0.0 35.4 0.8 52.0 0.8 0.0 35.6 1.1 74.0 0.8 0.0 36.5 1.3 58.0 0.8 0.0 36.5 1.3 61.0 0.8 0.0 37.1 0.9 43.0 0.8 0.0 38.0 0.8 55.0 0.8 0.0 38.0 0.8 60.0 0.8 0.0 38.4 0.6 42.0 0.8 0.0 38.8 0.6 57.0 0.8 0.0 39.0 0.5 41.0 0.8 0.0 39.4 0.8 78.0 0.8 0.0 40.0 0.8 50.0 0.8 0.0 40.0 0.8 64.0 0.8 0.0 40.0 1.0 80.0 0.8 0.0 40.8 0.8 46.0 0.8 0.0 40.8 0.8 60.0 0.8 0.0 41.5 0.5 63.0 0.8 0.0 42.0 0.8 49.0 0.8 0.0 42.0 0.8 82.0 0.8 0.0 42.8 0.8 62.0 0.8 0.0 42.8 0.8 73.0 0.8 0.0 42.8 0.8 83.0 0.8 0.0 43.5 0.8 54.0 0.8 0.0 43.5 0.8 69.0 0.8 0.0 44.3 2.0 38.0 0.8 0.0 44.3 1.8 64.0 0.8 0.0 44.3 1.8 66.0 0.8 0.0 45.3 1.8 68.0 0.8 0.0 45.3 1.8 70.0 0.8 0.0 46.3 1.8 42.0 0.8 0.0 46.3 1.8 59.0 0.8 0.0 46.3 1.8 61.0 0.8 0.0 47.0 1.4 63.0 0.8 0.0 47.0 1.4 65.0 0.8 0.0 47.6 0.8 69.0 0.8 0.0 47.6 0.8 71.0 0.8 0.0 48.4 2.0 38.0 0.8 0.0 48.4 1.8 75.0 0.8 0.0 48.4 1.8 77.0 0.8 0.0 49.4 1.8 68.0 0.8 0.0 49.4 1.8 70.0 0.8 0.0 50.4 1.8 41.0 0.8 0.0 50.4 1.8 59.0 0.8 0.0 50.4 1.8 61.0 0.8 0.0 51.1 2.9 63.0 0.8 0.0 51.1 2.9 65.0 0.8 0.0 52.3 1.8 76.0 0.8 0.0 52.3 1.8 78.0 0.8 0.0 53.6 1.0 37.0 0.8 0.0 53.6 1.1 60.0 0.8 0.0 53.6 1.1 71.0 0.8 0.0 54.6 1.1 36.0 0.8 0.0 54.6 1.1 57.0 0.8 0.0 54.6 1.1 68.0 0.8 0.0 55.8 1.0 37.0 0.8 0.0 55.8 1.1 60.0 0.8 0.0 55.8 1.1 71.0 0.8 0.0 56.5 0.6 64.0 0.8 0.0 56.9 0.8 36.0 0.8 0.0 56.9 0.8 57.0 0.8 0.0 56.9 0.8 68.0 0.8 0.0 56.9 0.8 70.0 0.8 0.0 57.6 1.1 38.0 0.8 0.0 57.6 1.1 47.0 0.8 0.0 57.6 1.1 55.0 0.8 0.0 57.6 1.1 66.0 0.8 0.0 58.6 1.1 36.0 0.8 0.0 58.6 1.1 57.0 0.8 0.0 58.6 1.1 68.0 0.8 0.0 59.8 1.0 37.0 0.8 0.0 59.8 1.1 60.0 0.8 0.0 59.8 1.1 71.0 0.8 0.0 60.5 0.6 64.0 0.8 0.0 60.9 0.8 43.0 0.8 0.0 60.9 0.8 57.0 0.8 0.0 60.9 0.8 68.0 0.8 0.0 61.6 1.1 36.0 0.8 0.0 61.6 1.1 45.0 0.8 0.0 61.6 1.1 53.0 0.8 0.0 61.6 1.1 64.0 0.8 0.0 62.8 1.1 33.0 0.8 0.0 62.8 1.1 42.0 0.8 0.0 62.8 1.1 50.0 0.8 0.0 62.8 1.1 61.0 0.8 0.0 63.9 1.1 36.0 0.8 0.0 63.9 1.1 45.0 0.8 0.0 63.9 1.1 53.0 0.8 0.0 63.9 1.1 64.0 0.8 0.0 64.8 0.5 67.0 0.8 0.0 64.8 0.5 69.0 0.8 0.0 65.0 1.1 33.0 0.8 0.0 65.0 1.1 42.0 0.8 0.0 65.0 1.1 50.0 0.8 0.0 65.0 1.1 61.0 0.8 0.0 66.3 1.0 36.0 0.8 0.0 66.3 1.1 59.0 0.8 0.0 66.3 1.1 70.0 0.8 0.0 67.3 1.1 35.0 0.8 0.0 67.3 1.1 56.0 0.8 0.0 68.4 1.1 36.0 0.8 0.0 68.4 1.1 45.0 0.8 0.0 68.4 1.1 53.0 0.8 0.0 68.4 1.1 64.0 0.8 0.0 69.5 2.5 33.0 0.8 0.0 69.5 2.5 42.0 0.8 0.0 69.5 2.5 50.0 0.8 0.0 69.5 2.5 61.0 0.8 0.0 72.0 2.5 31.0 0.8 0.0 72.0 2.5 40.0 0.8 0.0 72.0 2.5 48.0 0.8 0.0 72.0 2.5 59.0 0.8 0.0}

define process playtune (reps, pat, rate)
  run repeat reps
    for n = next(pat) + 24
    for r = next(rate)
    if r = 0.0 then set r = next(rate)
    if r > 10 then set r = r * 0.1
    send "mp:midi", key: key(n), dur: r
    wait r
  end

sprout playtune(60,markov-analyze(melody, order: 5, mode: 2), markov-analyze(rhythm, order: 5, mode: 2))